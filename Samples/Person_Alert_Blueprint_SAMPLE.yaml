# Here is a way to push a persistant notification to your screen
#   that will sit for a short time.  It is taylored to be part of
#   my Person Alert BP but with slight tweaking it could be used
#   for a lot of things. 

# Add to 'enter_action' and/or the 'leave_action' inputs:  (YAML Mode)
enter_action:
- service: script.personalert
  data:
    person: '{{ trigger.to_state.attributes.friendly_name }}'
    place: '{{ trigger.to_state.state }}'
    notify_id: '{{ trigger.to_state.context.id }}'
    phase: enter
leave_action:
- service: script.personalert
  data:
    person: '{{ trigger.to_state.attributes.friendly_name }}'
    place: '{{ trigger.to_state.state }}'
    notify_id: '{{ trigger.to_state.context.id }}'
    phase: leave

# Script being called
script:
  personalert_notify:
    alias: Person alert BP timed persistant_notification
    sequence:
    - alias: Notify interested parties WITH notification_id
      service: persistent_notification.create
      data:
        title: '{{ people + '' Status'' }}'
        message: >
          {{ 'Regarding: ' + people + '\nThey are now located at: ' + place +
          '\n' + flip + '\n\nNotification_id: ' + notify_id }}
        notification_id: '{{ notify_id }}'
    - alias: Add a delay so notification stays up a while
        # Pick your display time. If you set 0 this notification doesn't show.
      delay:
        seconds: 37
    - alias: Kill the notification
      service: persistent_notification.dismiss
      data:
        notification_id: '{{ notify_id }}'
    variables:
        # Define variable data and provide defaults
      people: placeholder1
      place: placeholder2
      notify_id: f7fa45c9-d780-475a-b5b0-8fca1dd57012
      phase: enter
      flip: >
        {% if phase == 'leave' %} They have left their previous location.
        {% else %}
        {% endif %}
    mode: queued
    icon: mdi:message-alert-outline
    max: 10


# Here is a way to push an audio message to your speakers
#   It is taylored to be part of my Person Alert BP but with slight 
#   tweaking it could be used for a lot of things. 

# Add to 'enter_action' and/or the 'leave_action' inputs:  (YAML Mode)
enter_action:
- service: script.personalert_audio
  data:
    message: >
      {{ trigger.to_state.attributes.friendly_name +
        ' has arrived at ' + trigger.to_state.state }}
    entities: media_player.home_group
leave_action:
- service: script.personalert_audio
  data:
    message: >
      {{ trigger.to_state.attributes.friendly_name +
        ' has left ' + trigger.to_state.state }}
    entities: media_player.home_group

# Script being called
script:
  personalert_audio:
    alias: Person alert BP TTS Message & Sound
    sequence:
    - alias: script
      service: tts.cloud_say
      data:
        entity_id: "{{ entities }}"
        message: "{{ message }}"
        options:
          gender: female
        language: en-CA
    - delay: 00:00:04
    - alias: MP3 to Speakers
      service: media_player.play_media
      data:
        entity_id: "{{ entities }}"
        media_content_id:
          "media-source://media_source/local/mp3/OK_tone.wav"
        media_content_type: audio/mp3
    variables:
        # Define variable data & provide default (change entities 4 your system)
      message: "I'm lost"
      entities: media_player.kitchen_speaker
    mode: queued
    icon: mdi:message-alert
    max: 10
